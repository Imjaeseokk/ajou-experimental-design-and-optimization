# Experimental Design and Optimization
## week4

## 실험계획법 필요성
예시 상황인 반도체 공정에서의 수율에 영향을 주는 변수를 제어하여 수율 향상을 위한
### 일반적인 방법
이력(양산) 데이터를 사용해 프로세스를 관찰
- 운이 좋으면 관찰 동안에 필요한 정보를 담은 상황 발생 가능
  - 산점도, 런차트, 관리도, 데이터 층별
  - 상관분석, 회귀분석, 분산분석(ANOVA)
- 제한 사항
  - 이력 데이터가 완전하지 않음: 원인 변수에 대한 정보가 부재
  - 결측치나 관찰치 누락이 발생: 데이터 수집 오류
  - 공정변수 간에 상관관계가 있는 경우가 있음
  - 중요한 변수들의 영향을 파악할 수 있을 만큼 충분한 변화를 보이지 않을 수도 있음
  → 필요한 데이터를 얻을 수 없는 경우가 있기 때문에 실험을 통하여 적절한 데이터를 구할 필요 있음

#### 체계적인 방법
프로세스에 대해 실험을 실시
- 적극적으로 input 변수를 조작함으로써, output 변수에 대한 그 영향을 분석할 수 있음
  - 어떤 변수들이 반응 y에 가장 영향을 미칠까?
  - y값이 요구되는 값에 인접하려면 x를 어느 정도로 설정할까?
  - y의 변동이 작게 하려면 x를 어느 정도로 설정할까?  


## 실험계획법 정의
### 역사적 고찰
실험 전략
- Screening
- Modeling을 통한 Optimization
실험에서 얻게 되는 지식
- 민감성, 특성화, 최적화, 강건성, X들에 대한 허용차 설계

### DOE: Desing of Experiment
#### 정의
>주어진 예산 (비용, 시간, ...) 하에서 최대의 정보를 얻고자 실험 방법과 분석 방법을 계획하는 것

#### 주요 결과
- 소수의 중요한 X의 영향 정도를 파악: Main effect or Factor effect
- 선정된 중요 X들 사이의 교호작용(interation) 파악: Interation effect
- X들을 이용한 Y들의 예측 모형 수립: Y = f(x_1,x_2, ... , x_p) + e
- Y들을 최적화 시키는 X들의 조건 결정(Optimization)

#### 활용
- 프로세스의 특성을 파악 
- 프로세스의 최적화
- 새로운 프로세스 개발
- 제품 설계

#### 실험의 정의
- 출력의 변화에 대한 원인을 관찰할 수 있도록 공정이나 시스템의 입력 변수에 계획된 변화를 가하는 일련의 시험
- 공정/시스템
  - 압력에 대해 하나 이상의 출력으로 변환시키는 기계, 방법, 사람, 또는 그 외 자원의 조합

#### IPO Model
- Input Process Output Model
- Supplier IPO Customer Model



#### 의의
실험계획을 결정하였다는 것은 해결하고자 하는 문제에 대하여 인자를 선정하고, 
실험 방법과 실험 순서를 정해서 실험 후에 얻어진 데이터에 대한 최적분석방법을 선택하였다는 것을 의미함

일반적으로 Y에 영향을 미치는 X들이 무수히 많고 시험조건에 따라 달라질 수 있기 때문에, Y를 발생시킨 X를 경험적으로 혹은 이론적으로 명백히 알아낸다는 것은 매우 어려움

→ 

**실험계획법**
- 실험의 목적을 만족시키고 적절한 성과물을 얻기 위해 가장 많은 정보를 가장 효율적으로 얻을 수 있는 일련의 실험조건을 결정하는 *실험전략*
- 공학적/과학적 연구를 체계적으로 계획, 수행하고 통계적으로 분석하는 *방법론*
- 특정 공정의 출력 결과값 변화의 원인을 알아내기 위해 통제 가능한 입력인자의 수준 값을 변화시켜 나가는 일련의 *실험과정*

#### DOE를 사용하는 목적
**추정과 검정**
> 어떤 원인이 반응에 유의한 영향을 주고 있는가를 파악하고 그 영향이 양적으로 어느 정도 큰가를 알아내고자 실시함  

**최적화**
> 유의한 영향을 미치는 원인들이 어떠한 조건을 가질 때 가장 바람직한 반응을 얻을 수 있는가를 알아내기 위해서 실시함


**4M1E**
- Men
- Method
- Material
- Machine
- Environment

#### 관련 용어
출력변수 Y
- Response로도 불림
- 해결안, 입력변수(인자)의 영향 효과
- Fish Bone Model

입력변수(인자): Xs
- Factor라고 불림
- 잠재 해결안 또는 연구 중인 변수
- 인자들은 Level 별로 분류됨

인자
- Factor
- 통제되거나 통제되지 않는 변수로서 실험을 할 때에 Response에 영향을 주는 것을 의미함
  
수준
- Level
- 실험 중에 인자의 값
- 정량적 인자의 경우에는 각각 선택한 인자의 값이 수준이 됨
- 정성적 인자에도 설정한 대로 몇 가지의 수준이 있음

처리
- Treatment
- 테스트 런 기간 동안에 단일 수준에 부여된 단일 인자

처리 조합
- 각각  input 변수에 일련의 수준을 이용한 테스트 런
- 전체 실험에서 처리 조합의 개수는 각각의 인자에 대한 수준 개수들의 곱을 의미함
- ex) 2 * 3 * 3의 경우의 실험 처리 조합은 18
  
반복
- Replication
- 테스트 런을 같은 처리 조합을 이용해서 순차적으로 몇 번 시행하는 것것

주효과
- Main effect
- 하나의 factor에서 한 수준에서 다른 수준으로 변화할 때에 일어나는 평균 response의 변화

교호작용
- Interaction
- Two factor 이상 특정한 인자 수준의 조합에 의해 일어나는 효과



## 실험계획법 종류
### 실험의 유형
- Trial and Error
- One-Factor-At-a Time: OFAT
- Keek The Winner
- Fractional Factorial Designs
- Full Factorial Designs
- Reponse Surface Methodoloty: RSM
- 혼합물 설계
- EVolutionary OPeration
  

#### OFAT
- 하나의 인자만을 변경하고 나머지 인자는 그대로 두면서 각 시행을 한 후에 결과를 표준과 비교
- 인자 조합이 누락될 수 있음
  
#### Keep The Winner
- 좋은 결과를 보인 인자는 그대로 두고, 나쁜 결과를 보인 인자를 변경하면서 각 시행 후에 결과를 표준과 비교
- 여전히 인자 조합이 누락될 수 있음

#### DOE
- 순차적인 실험
- 몇 개의 작은 실험으로 나누어 실험을 설계
- 각각의 실험을 보다 용이하게 관리할 수 있음
- 또한 목적하는 바에 좀 더 초점을 맞출 수 있도록 도와줌
- 이전의 실험에서 습득한 바에 근거하여 행하여 질 수 있음
**순서** 
Screening → Refining → Optimizing

#### Screening
- 목적: Y에 영향을 미치는 중요인자의 식별
- 결과
  - 어떤 인자가 Y에 영향을 미치는가를 알아보기 위해 부분요인실험(Fractional Factorial Design)을 사용하여 실험하고 분석하여 중요 인자를 선정

#### Refining
- 목적: 중요 인자가 Y에 어떤 영향을 미치는가를 알아냄

#### Optimizing
- 목적: Y를 최소화(최대화)하는 중요 인자의 수준 결정


>실험의 목적과 예산 등을 고려하여 DOE를 선택

### 실험계획 유의 사항
문제에 대하여 비통계적 지식을 사용하라
- 해당 분야의 전문가는 많은 경험과 지식 보유
- 비통계적 지식은 인자 선정, 인자 수준의 결정, 반복 횟수 결정, 분석 결과의 해석 등에 귀중하게 활용

설계와 분석은 가능한 간단히
- 지나치게 복잡하고 세련된 통계 기법 사용 자제
- 비교적 단순한 설계와 분석 기법이 가장 좋ㅇㅁ
  
실제와 통계적 의미와의 차이
- 통계적으로 의미 있는 결과일 지라도 실제로는 별로 의미가 없을 수도 있음


## 실험계획법 기본 원리
### Randomization
- 무작위 시행
- 선정된 인자 외에 기타 원인들의 영향이 실험결과에 편의되게 미치는 것을 제거
- 시간에 따라 변하는 인자의 효과나 경향을 실험 시간대에 대해 균일하게 배치하여 영향 약화
- 주관적 판단이 개입되는 실험에는 필수
- 무작위 시행은 추가적 비용과 노력을 필요로 함
- 종종 제한적 형태의 랜덤화 실시됨
  - 바꾸기 어려운 인자가 있다면 해당 인자는 바꾸기 쉬운 순서로 두고 나머지 인자에 대해 임의 순서 실험
  

### Blocking
- 블록화
- Block: 동일한 성질을 가진 단위들의 집합
- 잡음인자를 실험의 한 부분으로 만드는 것
- 실험 전체를 시/공간적으로 분할
  - 각 Block 내에서는 실험 환경이 균일함
- Block은 DOE에서 또 다른 독립인자로 취급
#### 블록화될 필요가 있는 경우
- 모든 실험을 한꺼번에 하는 것이 불가능
  - Days / Shifts / Location
- 유사한 원료로 모든 부분을 만들 수 없을 때
  - Lots / Batches / Plant Locations
- 비슷한 조건에서 검정할 수 없을 때
  - Machines / Workers / Customers 
#### 블록된 실험계획의 이점
- 알려진 잠재 변수의 효과를 우리가 집중할 요인 효과와 혼동하는 것을 방지
- 실험 변이성의 추정으로부터 변동의 알려진 원천 제거 가능
- 다른 Block에서 실험을 수행할 때, 처음 Block 실험 결과 확인 후 수행 가능

### Replication과 Repetition
- 측정 오차를 정량 산정하기 위해 실험을 반복하는 작업
- 반응에 나타난 변화가 실험 인자의 변화 때문인지 아니면 알 수 없는 통제 불가능한 변수로 인한 오차 때문인지를 밝힐 수 있음
- 동일 시험 내에서 두 가지 방법 모두 이용할 수 있음
- 둘 다 실험에서의 샘플 크기와 직접적 연관

### Replication
- 재현
- 시간 순서대로 전체 실험을 반복하는 것
- 실험 조건을 처음부터 다시 설정하여 실험
- 재현성 확인을 위해 실험결과의 신뢰성 향상을 도모
- 하나의 실험점에 해당하는 시료를 여러 개 만들어 한 번씩 실험
- 개개의 결과치를 분석 시 활용함


### Repetition
- 반복
- 한 실험 셋팅에서, 여러 개의 샘플을 사용하여 실험을 실시하는 것
- 시료를 여러 개 만들어 동일한 실험점에서 즉시 반복 실험을 수행함
- 동일한 실험점에서 반복 실험을 수행해서 측정이나 실험과정 상의 에러를 보상하는 방법
- 개개의 결과치의 평균을 분석 시 활용함
  
### 실험계획 순서
- 실험 목적 설정
- 특성치 선택
- 인자와 인자수준 선택
- 실험 배치와 실험순서 랜덤화: 요인배치법, 반응표면실험, 혼합물실험
- 실험 실시
- 데이터 분석: ANOVA, 상관분석, 회귀분석
- 분석결과 해석 및 조치

### 실험계획법 지침
문제 정의 및 기술
- 실험의 목적은?
  
반응 변수(특정치) 선정
- 이 변수는 프로세스에 대해 유용한 정보를 제공하는가?
- 정확하게 측정될 수 있는가?
  
인자 선택
- 과거 경험과 상관없이 어떤 변수가 중요한가?
- 실험에 영향 줄 자재, 시간, 장비 등과 같은 Blocking 변수는 없는가?

인자 수준 선택
- 우리가 관심 가질 값의 범위?
- 이 범위가 현실적 & 경제적?
- 이 범위에 곡선효과가 일어날 가능성?
- 수준이 반응 변수에 감지할 수 있는 영향을 줄 수 있는가?
  
실험계획 선택 - 실험 배치와 실험 순서
- 반복성 필요?
- 무작위성 필요?
- 블로킹 필요?

실험 실시
- 계획된 실험 순서로 데이터 수집
- 측정 시스템의 검증

데이터 분석
- 결과와 결론은 객관적이어야 하며 주관적 판단으로 해서는 안 됨

결론 및 권고
- 권고 실행 방안은?  







